$def with (mode)
<!DOCTYPE html> 
<html ng-app = 'albumApp' ng-init = 'greeting = true' ng-strict-di='false'>
<head profile="http://www.w3.org/2005/10/profile">
	<meta charset="UTF-8">


	$if mode == 'dev':
		<script src = 'static/js/angular_13.js'></script>
		<script src = 'static/js/angular-gettext.js'></script>
		<script src = 'static/js/pdfkit.js'></script>
		<script src = 'static/js/blob-stream.js'></script>
		<script src = 'static/js/exif.js'></script>

		<script src = 'static/js/siteController.js'></script>
		<script src = 'static/js/albumController.js'></script>
		<script src = 'static/js/pageController.js'></script>
		<script src = 'static/js/canvasController.js'></script>
		<script src = 'static/js/imageLoaderController.js'></script>
		<script src = 'static/js/layoutController.js'></script>
		<script src = 'static/js/textController.js'></script>
		<script src = 'static/js/services.js'></script>
		<script src = 'static/js/layoutFac.js'></script>
	$else:
		<script src = 'static/js/angular.min.js'></script>
		<script src = 'static/js/angular-gettext.min.js'></script>
		<script src = 'static/js/pdfkit.js'></script>
		<script src = 'static/js/blob-stream.js'></script>
		<script src = 'static/js/exif.js'></script>

		<script src = 'static/build/album.js'></script>

	<link rel="stylesheet" type="text/css" href="static/css/style.css" />
	 
	<link rel="icon" 
      type="image/ico" 
      href="static/icons/album.ico">

	<title>Create your own story</title> 
</head>

<body ng-controller = 'SiteController' ng-show = 'loaded' class = 'body'>

	<div id = 'banner'> 
		<span id = 'slogan' translate>Create your own story</span> 
		<div id = 'languages' class = 'inline'>
			<div class = 'clickable inline'
				title = 'English'
				ng-click = 'changeLanguage("en")'>
				<img src = 'static/icons/en.png' class = 'inline'>
			</div>
			<div class = 'clickable inline'
				title = 'Français'
				ng-click = 'changeLanguage("fr")'>
				<img src = 'static/icons/fr.png' class = 'inline'>
			</div>
			<div class = 'clickable inline'
				title = 'Tiếng Việt'
				ng-click = 'changeLanguage("vn")'>
				<img src = 'static/icons/vn.png' class = 'inline'>
			</div>
		</div>
	</div>
	<span style = 'position: absolute; top: 10%; left: 1%'>
		<img src = 'static/icons/go-home.png'
			class = 'clickable'
			title = '{{"Back to home page"|translate}}'
			ng-show = '!greeting' ng-click = 'goHome()'/>
	</span> 
	<div ng-if = 'greeting'>
		<span style = 'position: absolute; top: {{0.05*screenWidth + "px"}}; 
			font-size: 120%; font-weight: bold' translate> Welcome!</span>
	</div>

	<div ng-controller = 'AlbumController' ng-init = '\$parent.showAlbums = false'>
		<div ng-show = 'hideAlbum' class = 'pageDesactivate'
					tabindex = '0'
					style = 'width: {{screenWidth + "px"}}; height: {{screenHeight + "px"}}'>
		</div>
		
		<div tabindex = '0'
			ng-show = 'previewMode' id = 'previewPage'
			style = 'width: {{previewWidth + "px"}}; 
			height: {{previewHeight + "px"}};
			top: 7%; left: 8%'
			>
			<div
				id = 'leftPreview'
				ng-show = 'viewPageNum != 0'
				style = 'position: absolute; top: 0px; left: 0px; 
					width: {{previewWidth/2 + "px"}}; 
					height: {{previewHeight + "px"}}'>
			</div>
			<div
				id = 'rightPreview'
				ng-show = 'viewPageNum != album.content.length'
				style = 'position: absolute; top: 0px;
					left: {{previewWidth/2  + "px"}};
					width: {{previewWidth/2 + "px"}}; 
					height: {{previewHeight + "px"}};
					border-left: 1px solid #CCC;'>
			</div>
			<img 
				src = 'static/icons/window-close.png'
				style = 'margin-left: 101%; margin-top: -3%' 
				class = 'clickable'
				ng-click = 'removePreview()'/>
			<img 
				src = 'static/icons/next.png'
				style = 'position: absolute; left: 101%; top: 49%; width: 2%'
				class = 'clickable' 
				ng-show = 'viewPageNum != album.content.length'
				ng-click = 'previewPage(viewPageNum + 2)'/>
			<img 
				src = 'static/icons/prev.png'
				style = 'position: absolute;
				left:-3%; top: 49%; width: 2%'
				ng-show = 'viewPageNum != 0'
				class = 'clickable'
				ng-click = 'previewPage(viewPageNum - 2)'/>
		</div>
	<!--__________________welcome screen____________________-->

		<span class = 'bigbtn respond' ng-click = 'createAlbum()' 
				ng-show = 'showAlbums || greeting'
				style = 'position: absolute; left: 5%;
					top: {{0.1*screenWidth + "px"}};
					height: 1.5em'
				title = '{{"Click to create a new album"|translate}}'
				translate> 
				New album 
		</span>	
		<div ng-show = 'showAlbums'
			id = 'albumList'
			style = 'top: {{0.13*screenWidth + "px"}}'>
			<span style = 'font-weight: bold' translate> Your albums </span>
			<ul> 
				<li ng-repeat = 'albumSC in albumSCs' style = 'margin-bottom: 13px'>
					<span class = 'link respond'
						ng-click = 'openAlbum(albumSC)'
						ng-bind = 'albumSC.title||albumSC.date||"Album"'
						title = '{{"Click to go to album" | translate}}'></span> 
					<br/>
					<span ng-bind = 'albumSC.description'
						class = 'description'></span>
				</li>
			</ul>
		</div>
		
		<!--_____________begin album__________________-->
		<div ng-show = '\$parent.inAlbum'> 
			<div id = 'abTitle'>
				<div name = 'editTitle'
						ng-show = 'hasTitle'
						ng-click = 'editTitle()'>
					<span ng-bind = 'album.title' 
						name = 'title'
						ng-show = 'hasTitle'> 
					</span>
					<img src = 'static/icons/edit.png'
						title = '{{"edit title"|translate}}'
						name = 'edit'
						class = 'clickable'/>
				</div>
				
				<form ng-submit = 'showTitle()'
						class = 'inline left'
						ng-show = 'enterTitle'>
					<input type = 'text' 
						id = 'titleInput'
						ng-model = 'album.title'
						ng-blur = 'titleBlur()'
						maxlength = '20'
						placeholder = '{{"Enter a title"| translate}}'
						required
						value = 'album.title'>
					</input>
				</form>
				

					
				<div class = 'right inline clickable'
					ng-show = 'hasDescription'
					ng-click = 'editDescription()'>
					<span ng-bind = 'album.description'
						class = 'description'>
					</span>
					<img src = 'static/icons/edit.png'
						title = '{{"edit description"|translate}}'
						name = 'edit'
						class = 'clickable'/>
				</div>
				
				<form ng-submit = 'showDescription()'
					ng-if = 'enterDescription'
					class = 'inline right'
					ng-click = 'editDescription()'>
					<input type = 'text' 
						id = 'inputDescription'
						ng-model = 'album.description'
						ng-blur = 'descriptionBlur()'
						maxlength = '40'
						placeholder = '{{"Enter a description"|translate}}'
						value = 'album.title'
						>
					</input>
				</form>
				
			</div>

			<div id = 'sideMenu'>
			
				<span class = 'link respond' ng-click = 'createAlbum()' 
					title = '{{"Click to create a new album"|translate}}'
					translate>
					New album 
				</span>
				<br/> <br/>
				<span class = 'link respond' id = 'allAlbums' 
					ng-click = 'toAlbumList()' translate>
					Your albums
				</span>
				<br/> <br/>

				<span class = 'link respond' 
					ng-click = 'delAlbumRq()' translate>
					Remove this album
				</span>
				
				
				<div  class = 'alert'
						style = 'width: {{screenWidth/4 + "px"}}; 
										left: {{screenWidth/4 + "px"}}; 
										top: {{screenWidth/12 +"px"}}'
						ng-show = 'delAlbum'
						ng-keydown = 'alertKeydown(\$event)'>
						<span style = 'color: red' translate>
							The album 
						</span>
						<span style = 'font-weight: bold'> {{album.title}} </span> 
						<span  style = 'color: red' translate>will be removed definitely.</span>
						<br/>
						<span style = 'color: red' translate>
							Are you sure to delete this album?
						</span>
						<br/> <br/>
						<button type = 'button' class = 'respond'
							id = 'delAlbum'
							ng-click = 'removeAlbum(current.albumId)'
							style = 'float: left' translate>
							Yes, delete it.
						</button>
						<button type = 'button' class = 'respond' 
							id = 'notDelAlbum'
							ng-click = 'delAlbum = false; hideAlbum = false' 
							style = 'float: right' translate>
							No, do not delete.
						</button>
				</div>
				<br/> <br/>
				
				<div id = 'export'>
				<span class = 'bigbtn respond' 
					ng-click = 'generatePdf()' 
					title = '{{"Export this album to pdf file to use on your computer or for printing"|translate}}' 
					translate>
					Export pdf album
				</span>

				<div ng-show = 'processing' style = 'font-size: 80%' > 
					<span translate>
						Generating pdf...
					</span>
					<br/>
					<span translate>
						...processing page {{processPage}}
					</span>
					<br/>
					<span ng-show = 'showLink' translate>...finished!</span>
				</div>

				<span ng-show = 'showLink'>
					<a download = '{{album.title + ".pdf"}}' 
						id = 'pdfoutput' translate>
						Download
					</a>
				</span>
				
				
			</div>
			
			</div>

			<div id = 'album'
				ng-mouseup = 'mouseUp(\$event)'>
				<div id = 'doublepage'>
				<!--head line-->
						
						
					<div id = 'prev' class = 'link'
						ng-show = 'show.leftPage' 
						ng-click = 'prevPage()'
						title = '{{"go to the previous page"|translate}}'>
						<img src = 'static/icons/prev.png'
								class = 'prevnext'
								/>
						<span translate> previous </span>
					</div>
					
					<div id = 'next' class = 'link'
						ng-show = 'show.rightPage' 
						ng-click = 'nextPage()'
						title = '{{"go to the next page"|translate}}'>
						<img src = 'static/icons/next.png'
								class = 'prevnext'
								></img>
						<span translate>next</translate>
					</div>
					
					<div id = 'topMenu'>
						<span id = 'addPage ' 
							class = 'link'
							title = '{{"Add a new double page"|translate}}'
							ng-click = 'addNewPage()'>
							<img src = 'static/icons/addpage.svg'
								class = 'inline respond'
								style = 'height: 130%; margin-left: 2%'/> 
						</span>
						

						
						<span class = 'draggable link'
							id = 'addText'
							
							title = '{{"Drag and drop into page to add a text field"|translate}}'>
							<img  src = 'static/icons/text2.svg'
								draggable = 'true'
								ondragstart = 'angular.element(this).scope().dragText(event)'
								class = 'inline respond'
								style = 'height: 150%;'
								/>
						</span>
						
						<span class = 'draggable link'
							id = 'addFrame'
							draggable = 'true'
							ondragstart = 'angular.element(this).scope().dragFrame(event)'
							title = '{{"Drag and drop into page to add a new frame"|translate}}'>
							<img src = 'static/icons/frame.svg'
								class = 'inline respond'
								style = 'height: 140%'/>
						</span>
						
						
						<span class = 'link'
							ng-click = 'previewPage(current.pageNum)'
							title = '{{"Preview album"|translate}}'
							style = 'margin-left: 1em'>
							<img src = 'static/icons/preview.svg'
								class = 'inline respond'
								style = 'height: 140%'/>
						</span>
						<span id = 'removePage' 
							class = 'link'
							title = '{{"Delete this double page"|translate}}'
							ng-click = 'removePage()'>
							<img src = 'static/icons/delpage.svg'
								class = 'inline respond'
								style = 'height: 150%'/>
						</span>
					</div>
					
					<span ng-show = 'show.leftPage'
						id = 'leftPageNum'>
						{{current.pageNum}}/{{album.content.length}}
					</span>
					<span ng-show = 'show.rightPage'
						id = 'rightPageNum'>
						{{current.pageNum + 1}}/{{album.content.length}}
					</span>


					<!--______________________a page in album______________________-->


					<div ng-repeat = 'page in ["leftPage", "rightPage"]'
						id = '{{page}}'
						class = 'page'
						ng-controller = 'PageController'
						ng-if = 'show[page]'
						tabindex = 0
						ondrop = 'angular.element(this).scope().dropInPage(event)' 
						ondragover = 'angular.element(this).scope().allowDropInPage(event)'
						ng-mousemove = 'mouseMove(\$event)'
						ng-focus = 'pageFocus(\$event)'
						style = 'width: {{pageWidth}}; height: {{pageHeight}}; 
							background-color: {{current[page].background}}'>
						
						<div ng-repeat= 'frame in current[page].frames' 
							ng-controller='CanvasController'
							ng-style='{cursor: current.cursor}'>
							<canvas tabindex = '0' 
										class = 'frame inPage'
										title = '{{"Drag a corner or an edge to redimension the frame."| translate}}'
										ondrop = 'angular.element(this).scope().dropInCanvas(event)' 
										ondragover = 'angular.element(this).scope().allowDrop(event)'
										ng-mousedown = 'mouseDown(\$event)' 
										ng-mousemove = 'mouseMove(\$event)'
										ng-keydown = 'keyDown(\$event)'
										ng-focus = 'canvasFocus(\$event)'
										ng-blur = 'canvasBlur(\$event)'
										>
							</canvas>
						</div>
						
						<div ng-repeat = 'textBox in current[page].textBoxes' 
							ng-controller = 'TextBoxController'
							>
							<textarea name = 'textbox'
								class = 'inPage'
								placeholder = '{{"Enter text here"| translate}}'
								ng-style='{cursor: current.cursor}'
								title = '{{"Ctrl+Del to delete. Ctrl + arrows to move it around. Drag the bottom-right corner to redimension."|translate}}'
								ng-model = 'textBox.text'
								ng-mousedown = 'mouseDown(\$event)'
								ng-mousemove = 'mouseMove(\$event)'
								ng-keyup = 'autoResize(\$event)'
								ng-focus = 'textFocus(\$event)'
								ng-blur = 'blur(\$event)'
								ng-keydown = 'keyDown(\$event)'
								style = 'position: absolute;
											z-index: 1;
											background-color: transparent;
											padding: 0;
											overflow: hidden'>
							</textarea>
						</div>

					</div>
					
					<div id = 'controls'
						ng-mousedown = 'controlsMouseDown()'
						ng-mouseleave = 'controlsMouseLeave()'
						class = 'controls'>
						<div id = 'textControl'
							
							ng-controller = 'TextController'
							ng-show = 'current.onEditText'>
							<span 
								
								style = 'font-weight: bold; 
									font-size: 90%; 
									margin-right: 0.5em; margin-left: 1em;' translate>
									Style text
							</span>
							<select style = 'height: 2em' 
								
								title = '{{"Choose text font"|translate}}'
								ng-model = 'current.font.family' 
								ng-change = 'changeFont(current.font.family)'>
								<option
									
									ng-repeat = 'font in fonts'
									value = {{font}}
									style = 'font-family: {{font}}'>
									{{font}}
								</option> 
							</select> 
							
							<select 
								
								style = 'height: 2em'
								title = '{{"change font size"|translate}}'
								ng-model = 'current.font.size'
								ng-change = 'changeFontSize(current.font.size)'>
								<option 
									
									ng-repeat = 'i in [8, 10, 12, 14, 16, 18, 20, 24, 30]'
									value = '{{i + "px"}}'> {{i}} </option>
							</select>
							
							<span class = 'btn respond  italic ' 
								ng-click = 'italicClick()'>
								I
							</span>
							
							<span class = 'btn respond  bold '
								ng-click = 'boldClick()'>
								B
							</span>
							
							<!--Color falldown menu -->
							<div class = 'inline textColorMenu'>
								<span 
									id = 'textColor'
									class = 'btn respond '
									ng-click = 'showColors()'
									title = '{{"Choose text color"|translate}}'
									style = 'color: {{current.font.color}}'
									translate>
									Text color
								</span>
								<br/>
								<div tabindex = 0
									
									id = 'colorMenu'
									ng-if = 'showColorMenu' 
									ng-init = 'showColorMenu = false'>
									<div class = 'colorTable '
										tabindex = 0 
										ng-repeat = 'color in colors'
										style = 'background-color:{{color}};
														float:left'
										ng-focus = 'changeColor(color)'>
									</div>
								</div>
							</div>
							<!-- end of color menu-->
							
							<span 
								class = 'btn respond '
								title = '{{"Align text left"|translate}}'
								ng-click = 'align("left")'>
								<img src = 'static/icons/left.svg' 
									class = 'inline '
									style = 'height: 100%'/>
							</span>
							<span
								class = 'btn respond '
								title = '{{"Align text right"|translate}}'
								ng-click = 'align("right")'>
								<img src = 'static/icons/right.svg'
									class = 'inline '
									style = 'height: 100%'/>
							</span>
							<span 
								class = 'btn respond '
								title = '{{"Align text center"|translate}}'
								ng-click = 'align("center")'>
								<img src = 'static/icons/center.svg' 
									class = 'inline '
									style = 'height: 100%'/>
							</span>
							
							<span class = 'btn respond '
								title = '{{"Remove text box"|translate}}'
								ng-click = 'removeTextArea()'
								style = 'float: right; margin-right: 0.5em'>
								<img src = 'static/icons/trash.png'
									class = 'inline '
									style = 'height: 100%; '/>
							</span>
						
						</div>
						
						<div id = 'imageControl' 
							
							ng-controller = 'ImageController'
							ng-show = 'current.onEditImage'>
							<span 
								
								style = 'font-size: 90%; font-weight: bold;
								margin-left: 1em; margin-right: 0.5em'
								translate>
								Style image
							</span>
							<span
								ng-mousedown = 'zoomImage("in")'
								ng-mouseup = 'mouseUp()'
								ng-mouseleave = 'mouseLeave()'
								title = '{{"Zoom image in. Hot key: +"|translate}}'
								class = 'btn respond control '
								style = 'padding: 4px;'>
								<img 
									src = 'static/icons/zoomin.png'
									style = 'height: 130%'/> </span>
							<span
								ng-mousedown = 'zoomImage("out")'
								ng-mouseup = 'mouseUp()'
								ng-mouseleave = 'mouseLeave()' 
								title = '{{"Zoom image out. Hot key: -"|translate}}'
								class = 'btn respond  inline '
								style = 'padding: 4px'>
								<img
									
									src = 'static/icons/zoomout.png'
									style = 'height: 130%'/> </span>
									
							<span ng-mousedown = 'go("left")'
								ng-mouseup = 'mouseUp()'
								ng-mouseleave = 'mouseLeave()'
								title = '{{"Go to the left of image. Hot key: Ctrl + arrow left."|translate}}'
								class = 'btn respond  inline '
								style = 'padding: 4px'>
								<img src = 'static/icons/goleft.png' 
									class = 'inline '
									style = 'height: 100%'/>
							</span>
							
							<span ng-mousedown = 'go("right")'
								ng-mouseup = 'mouseUp()'
								ng-mouseleave = 'mouseLeave()'
								title = '{{"Go to the right of image. Hot key: Ctrl + arrow right."|translate}}'
								class = 'btn respond  inline '
								style = 'padding: 4px'>
								<img src = 'static/icons/goright.png' 
									class = 'inline '
									style = 'height: 100%'/>
							</span>
							
							<span ng-mousedown = 'go("up")'
								ng-mouseup = 'mouseUp()'
								ng-mouseleave = 'mouseLeave()'
								title = '{{"Go to the top of image. Hot key: Ctrl + arrow up."|translate}}'
								class = 'btn respond  inline '
								style = 'padding: 4px'>
								<img src = 'static/icons/goup.png' 
									class = 'inline '
									style = 'height: 100%'/>
							</span>
							
							<span ng-mousedown = 'go("down")'
								ng-mouseup = 'mouseUp()'
								ng-mouseleave = 'mouseLeave()'
								title = '{{"Go to the bottom of image. Hot key: Ctrl + arrow down."|translate}}'
								class = 'btn respond  inline '
								style = 'padding: 4px'>
								<img src = 'static/icons/godown.png' 
									class = 'inline '
									style = 'height: 100%'/>
							</span>
								
							<span ng-click = 'removeImage()'
								title = '{{"Delete image. Hot key: Ctrl + Del. Use Del to remove the frame and its content."|translate}}'
								class = 'btn respond '
								style = 'float: right; margin-right: 0.5em'> 
								<img
									
									src = 'static/icons/trash.png'
									style = 'height: 110%'/> </span>
							
						</div>
					</div>
					
				</div>
			
				<!--_______________select layout________________________-->
				<div id = 'selectLayout'
					class = 'layoutCtrl'
					ng-controller = 'LayoutController'
					>
					<span 
						
						style = 'font-weight: bold; font-size: 90%; margin-left: 1em' 
						translate>
						Choose page layout
					</span>
					<span 
						style = 'font-size: 80%'
						translate> (photos/page)</span> 
					
					<div id = 'layoutSets'
						>
						<span ng-repeat = 'choice in layoutList'
							class = 'link layout respond ' 
							ng-click = 'showLayouts(choice)'>
							  {{choice}} 
						</span>
					</div>
					
	<!--Choose page background color============================-->
	
					<div id = 'pageBGcolor' class = 'BGcolorMenu'>
						<span class = 'btn respond'
							title = '{{"Choose page background color"|translate}}'
							ng-click = 'showColors()'
							ng-blur = 'cbBlur()'
							translate>
							Page background
						</span>
						<br/>
						<div tabindex = '0'
							id = 'BGcolorMenu'
							ng-show = 'showColorMenu' 
							ng-init = 'showColorMenu = false'>
							<div class = 'colorTable link '
								tabindex = 0 
								ng-repeat = 'color in colors'
								style = 'background-color:{{color}};'
								ng-click = 'changeBGColor(color)'>
							</div>
							<div class = 'inline'
								style = 'float: left; background-color: #FFFFFF
									 height: 1.5em'>
							<form class = 'inline ' ng-submit = 'getUserColor()'>
									<input type = 'text'
										
										style = 'width: 7em'
										ng-model = 'userColor'
										placeholder = '#FFFFFF'>
									</input>
							</form>
							</div>
							<div class = 'link small respond '
								style = 'text-align: center; line-height: 1.8em;
									float: right'
								ng-click = 'changeAlbumBGColor()' translate>
								Apply for all pages
							</div>
							
						</div>
					</div>
				<!--===============================================================-->
	
					<div id = 'layouts' >
						<canvas ng-repeat = 'layout in layouts'
							title = '{{"Choose a page first then click on the layout to load to the chosen page."|translate}}'
							ng-controller = 'minLayoutController'
							ng-click = 'loadPageLayout(layout)'
							ng-mouseover = 'previewLayout(layout, \$event)'
							ng-mouseleave = 'mouseLeave()'
							class = 'clickable minframe '> 
						</canvas>
					</div>
				</div>
				<!--___________________end of select layour____________________-->
		
			<!--___________________image loader_____________________________-->
				<div id = 'imageLoader'
					ng-controller = 'ImageLoaderController'
					ng-if = 'imgLoad'>
					<label for = 'files' class = 'medbtn'
						id = 'loadPhotos'
						title = '{{"Click to load photos from your computer"|translate}}'
						> 
						<span style = 'margin-right: 1em' translate> Load photos </span> 
						<!--<img class = 'inline'
							 style = 'height: 130%' 
							src = 'static/icons/folder-image.png'/>-->
					</label>
					<!--<span style = 'font-size: 80%'
						ng-show = 'loading'>{{fileProcess}}</span>-->
					<input type = 'file' id = 'files' 
						style = 'display: none'
						onchange = 'angular.element(this).scope().handleFileSelect(event)'
						multiple />
					<div id = 'output'></div>
				</div>
			</div>

		</div>

	</div>
</body>
</html>
